ce qu'il se passe :
1.SQuery-To-SQL.ps1 --> interface graphique
2.    |--> SQuery-SQL-Translator.psm1 --> recupère URL parse squery, queryrootEntityType et QueryRoot
3.        |--> Lexer.ps1  --> tokenise la squery (c'est une classe, pas une fonction).
4.    |--> Squery-SQL-Translator.psm1 --> on a l'url Ou chaque Token est un objet avec des informations sur ces tokens (Operateur, identifier, boolean...)
5.        |--> Parser.ps1 --> parcour les token, regroupes ces token en fonction des fonctions principales 'join' 'top' 'where' 'select' 'order', avec pour certains eux memes des objets dedans (notamment le Where)
6.    |--> Squery-SQL-Translator.psm1 --> on a la liste des elements de l'URL regroupé par mots clef.
7.        |--> Validator.ps1 --> Outil de sécurité pour juger que l'URL fournit ne sort pas des normes (Where trop long, TOP trop grand etc..), check database-mapping.json
8.    |--> Squery-SQL-Translator.psm1 --> la query SQL qu'on va généré dans le futur "certifié" d'être valide 
9.        |--> Transformer.ps1 --> Transformer() -> utilise les json dans Configs pour faire la traduction avec les tokens.
10.       |--> Transformer.ps1 --> Build() -> assemble toutes les traductions faites pour former la requete SQL
11.   |--> Squery-SQL-Translator.psm1 --> print la query et remonte les warnings si il y en a

1. http://localhost:5000/api/ProvisioningPolicy/AssignedResourceType?api-version=1.0&squery=join+Role+r+join+WorkflowInstance+w+join+ParametersContext+pc+join+Owner+of+type+Directory_FR_User+Owner+top+4+select+Id,+StartDate,+EndDate,+ProvisioningState,+WorkflowState,+IsDenied,+RoleId,+ResourceId,+OwnerType,+OwnerId,+WorkflowInstanceId,+ParametersContextId,+r.BlockProvisioning,+r.FullName,+w.Id,+w.Identifier,+Owner.InternalDisplayName,+Owner.Id,pc.DisplayName+where+(OwnerType%3D2015+AND+((ProvisioningReviewFilter%3E0+AND+ProvisioningReviewFilter%3C16)+OR+ProvisioningReviewFilter%3E31))+order+by+WorkflowInstanceId+desc,+OwnerId+desc,+Id+desc&QueryRootEntityType=AssignedResourceType

2.
-SQuery:
 join Role r join WorkflowInstance w join ParametersContext pc join Owner of type Directory_FR_User Owner top 4 select Id, StartDate, EndDate, ProvisioningState, WorkflowState, IsDenied, RoleId, ResourceId, OwnerType, OwnerId, WorkflowInstanceId, ParametersContextId, r.BlockProvisioning, r.FullName, w.Id, w.Identifier, Owner.InternalDisplayName, Owner.Id,pc.DisplayName where (OwnerType=2015 AND ((ProvisioningReviewFilter>0 AND ProvisioningReviewFilter<16) OR ProvisioningReviewFilter>31)) order by WorkflowInstanceId desc, OwnerId desc, Id desc 

-Root Entity:
 AssignedResourceType

3.Every tokens : [KEYWORD:'join'] [IDENTIFIER:'Role'] [IDENTIFIER:'r'] [KEYWORD:'join'] [IDENTIFIER:'WorkflowInstance'] [IDENTIFIER:'w'] [KEYWORD:'join'] [IDENTIFIER:'ParametersContext'] [IDENTIFIER:'pc'] [KEYWORD:'join'] [IDENTIFIER:'Owner'] [KEYWORD:'of'] [KEYWORD:'type'] [IDENTIFIER:'Directory_FR_User'] [IDENTIFIER:'Owner'] [KEYWORD:'top'] [NUMBER:'4'] [KEYWORD:'select'] [IDENTIFIER:'Id'] [COMMA:','] [IDENTIFIER:'StartDate'] [COMMA:','] [IDENTIFIER:'EndDate'] [COMMA:','] [IDENTIFIER:'ProvisioningState'] [COMMA:','] [IDENTIFIER:'WorkflowState'] [COMMA:','] [IDENTIFIER:'IsDenied'] [COMMA:','] [IDENTIFIER:'RoleId'] [COMMA:','] [IDENTIFIER:'ResourceId'] [COMMA:','] [IDENTIFIER:'OwnerType'] [COMMA:','] [IDENTIFIER:'OwnerId'] [COMMA:','] [IDENTIFIER:'WorkflowInstanceId'] [COMMA:','] [IDENTIFIER:'ParametersContextId'] [COMMA:','] [IDENTIFIER:'r'] [DOT:'.'] [IDENTIFIER:'BlockProvisioning'] [COMMA:','] [IDENTIFIER:'r'] [DOT:'.'] [IDENTIFIER:'FullName'] [COMMA:','] [IDENTIFIER:'w'] [DOT:'.'] [IDENTIFIER:'Id'] [COMMA:','] [IDENTIFIER:'w'] [DOT:'.'] [IDENTIFIER:'Identifier'] [COMMA:','] [IDENTIFIER:'Owner'] [DOT:'.'] [IDENTIFIER:'InternalDisplayName'] [COMMA:','] [IDENTIFIER:'Owner'] [DOT:'.'] [IDENTIFIER:'Id'] [COMMA:','] [IDENTIFIER:'pc'] [DOT:'.'] [IDENTIFIER:'DisplayName'] [KEYWORD:'where'] [LPAREN:'('] [IDENTIFIER:'OwnerType'] [OPERATOR:'='] [NUMBER:'2015'] [KEYWORD:'and'] [LPAREN:'('] [LPAREN:'('] [IDENTIFIER:'ProvisioningReviewFilter'] [OPERATOR:'>'] [NUMBER:'0'] [KEYWORD:'and'] [IDENTIFIER:'ProvisioningReviewFilter'] [OPERATOR:'<'] [NUMBER:'16'] [RPAREN:')'] [KEYWORD:'or'] [IDENTIFIER:'ProvisioningReviewFilter'] [OPERATOR:'>'] [NUMBER:'31'] [RPAREN:')'] [RPAREN:')'] [KEYWORD:'order'] [KEYWORD:'by'] [IDENTIFIER:'WorkflowInstanceId'] [KEYWORD:'desc'] [COMMA:','] [IDENTIFIER:'OwnerId'] [KEYWORD:'desc'] [COMMA:','] [IDENTIFIER:'Id'] [KEYWORD:'desc']

5.Parsed AST Joins: [
    {
        "EntityPath":  "Role",
        "TypeFilter":  null,
        "Alias":  "r"
    },
    {
        "EntityPath":  "WorkflowInstance",
        "TypeFilter":  null,
        "Alias":  "w"
    },
    {
        "EntityPath":  "ParametersContext",
        "TypeFilter":  null,
        "Alias":  "pc"
    },
    {
        "EntityPath":  "Owner",
        "TypeFilter":  "Directory_FR_User",
        "Alias":  "Owner"
    }
]
Parsed AST Top: 4
Parsed AST Select: Id StartDate EndDate ProvisioningState WorkflowState IsDenied RoleId ResourceId OwnerType OwnerId WorkflowInstanceId ParametersContextId r.BlockProvisioning r.FullName w.Id w.Identifier Owner.InternalDisplayName Owner.Id pc.DisplayName
Parsed AST Where: {
    "Left":  {
                 "Field":  "OwnerType",
                 "Op":  "=",
                 "Value":  2015,
                 "ExprType":  "compare"
             },
    "LogOp":  "AND",
    "Right":  {
                  "Left":  {
                               "Left":  {
                                            "Field":  "ProvisioningReviewFilter",
                                            "Op":  "\u003e",
                                            "Value":  0,
                                            "ExprType":  "compare"
                                        },
                               "LogOp":  "AND",
                               "Right":  {
                                             "Field":  "ProvisioningReviewFilter",
                                             "Op":  "\u003c",
                                             "Value":  16,
                                             "ExprType":  "compare"
                                         },
                               "ExprType":  "logical"
                           },
                  "LogOp":  "OR",
                  "Right":  {
                                "Field":  "ProvisioningReviewFilter",
                                "Op":  "\u003e",
                                "Value":  31,
                                "ExprType":  "compare"
                            },
                  "ExprType":  "logical"
              },
    "ExprType":  "logical"
}
Parsed AST OrderBy: [
    {
        "Field":  "WorkflowInstanceId",
        "Direction":  "DESC"
    },
    {
        "Field":  "OwnerId",
        "Direction":  "DESC"
    },
    {
        "Field":  "Id",
        "Direction":  "DESC"
    }
]

5.Transformed SQL Builder: {
    "SelectFields":  [
                         "art.Id",
                         "art.StartDate",
                         "art.EndDate",
                         "art.ProvisioningState",
                         "art.WorkflowState",
                         "art.IsDenied",
                         "art.Role_Id",
                         "art.Resource_Id",
                         "art.OwnerType",
                         "art.Owner_Id",
                         "art.WorkflowInstance_Id",
                         "art.ParametersContext_Id",
                         "r.BlockProvisioning",
                         "r.FullName_L1",
                         "w.Id",
                         "w.Identifier",
                         "Owner.InternalDisplayName_L1",
                         "Owner.Id",
                         "pc.DisplayName_L1"
                     ],
    "TableName":  "[dbo].[UP_AssignedResourceTypes]",
    "TableAlias":  "art",
    "JoinClauses":  [
                        "LEFT JOIN [dbo].[UP_ResourceTypes] r ON art.Role_Id = r.Id",
                        "LEFT JOIN [dbo].[UW_WorkflowInstances] w ON art.WorkflowInstance_Id = w.Id",
                        "LEFT JOIN [dbo].[UP_Contexts] pc ON art.ParametersContext_Id = pc.Id",
                        "LEFT JOIN [dbo].[UR_Resources] Owner ON art.Owner_Id = Owner.Id"
                    ],
    "WhereSQL":  "(art.OwnerType = @p1 AND ((art.ProvisioningReviewFilter \u003e @p2 AND art.ProvisioningReviewFilter \u003c @p3) OR art.ProvisioningReviewFilter \u003e @p4))",
    "OrderFields":  [
                        {
                            "Field":  "art.WorkflowInstance_Id",
                            "Direction":  "DESC"
                        },
                        {
                            "Field":  "art.Owner_Id",
                            "Direction":  "DESC"
                        },
                        {
                            "Field":  "art.Id",
                            "Direction":  "DESC"
                        }
                    ],
    "TopValue":  4,
    "LimitValue":  0,
    "OffsetValue":  0,
    "Parameters":  {
                       "p1":  2015,
                       "p4":  31,
                       "p2":  0,
                       "p3":  16
                   }
}

9.the output SQL

pour moi :
voir si je peux pas faire un export du swagger, pour lister les EntityTypes natifs, leur propriétés. surement utiles pour les méthodes GET, et POST/DELETE dans le futur

comme ça je peux faire      
- export complet de la DB : toutes les tables, toutes les colonnes de chaques tables
on pourra aussi faire la liste de ce qui est JOIN_able ou pas, par exemple CompositeRole et CompositeRoleRule, Entry et AccessControleRule.
    --> voir si ls foreignKey sont référencé comme ForeignKey et si elle sont ciblé, ça nous eviterait de tout faire a la main.

Requete SQL pour voir si ça fonctione : 
SELECT
    fk.name                          AS FK_Name,
    tp.name                          AS ParentTable,
    cp.name                          AS ParentColumn,
    tr.name                          AS ReferencedTable,
    cr.name                          AS ReferencedColumn
FROM sys.foreign_keys            fk
JOIN sys.foreign_key_columns     fkc ON fk.object_id = fkc.constraint_object_id
JOIN sys.tables                  tp  ON fkc.parent_object_id = tp.object_id
JOIN sys.columns                 cp  ON fkc.parent_object_id = cp.object_id AND fkc.parent_column_id = cp.column_id
JOIN sys.tables                  tr  ON fkc.referenced_object_id = tr.object_id
JOIN sys.columns                 cr  ON fkc.referenced_object_id = cr.object_id AND fkc.referenced_column_id = cr.column_id
ORDER BY tp.name, cp.name


- export complet du swagger
                            faire le lien entre eux et tout garder localement.

On a indiqué qu'il y avait que Resources en custom, mais il y a aussi la table Dimensions

